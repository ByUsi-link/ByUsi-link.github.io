"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[826],{55826:function(e,n,l){l.d(n,{Z:function(){return components_Layout}});var i=l(85893),t=l(67294),a=l(2734),s=l(61730),r=l(35294),o=l(18972),d=l(48885),c=l(59334),h=l(77533),x=l(5616),u=l(78462),p=l(70891),m=l(42293),j=l(10155),Z=l(93946),f=l(15861),g=l(11057),v=l(69661),b=l(44182),y=l(326),C=l(28201),w=l(49123),k=l(15398),W=l(85938),S=l(96540),P=l(66040),_=l(11163),L=l(87179),q=l(50657),D=l(37645),U=l(10760),B=l(40044),T=l(6514),z=l(21737),A=l(19273),E=l(31425);let TabPanel=e=>{let{children:n,value:l,index:t,...a}=e;return(0,i.jsx)("div",{role:"tabpanel",hidden:l!==t,id:"auth-tabpanel-".concat(t),"aria-labelledby":"auth-tab-".concat(t),...a,children:l===t&&(0,i.jsx)(x.Z,{sx:{pt:3},children:n})})};var components_LoginDialog=e=>{let{open:n,onClose:l}=e,{login:a}=(0,L.a)(),[s,r]=(0,t.useState)(0),[o,d]=(0,t.useState)(!1),[c,h]=(0,t.useState)(""),[u,p]=(0,t.useState)({identifier:"",password:""}),[m,j]=(0,t.useState)({username:"",email:"",password:"",confirmPassword:""}),handleLogin=async e=>{e.preventDefault(),d(!0),h("");try{let e=await a(u.identifier,u.password);e?(l(),p({identifier:"",password:""})):h("登录失败，请检查用户名和密码")}catch(e){h("登录失败，请稍后重试")}finally{d(!1)}},handleRegister=async e=>{if(e.preventDefault(),h(""),m.password!==m.confirmPassword){h("两次输入的密码不一致");return}window.open("https://byusiaccount.cn/r","_blank"),h("请在新窗口中完成注册，然后返回登录")};return(0,i.jsxs)(q.Z,{open:n,onClose:l,maxWidth:"sm",fullWidth:!0,children:[(0,i.jsx)(D.Z,{children:(0,i.jsxs)(U.Z,{value:s,onChange:(e,n)=>{r(n),h("")},centered:!0,children:[(0,i.jsx)(B.Z,{label:"登录"}),(0,i.jsx)(B.Z,{label:"注册"})]})}),(0,i.jsxs)(T.Z,{children:[c&&(0,i.jsx)(z.Z,{severity:"error",sx:{mb:2},children:c}),(0,i.jsxs)(TabPanel,{value:s,index:0,children:[(0,i.jsxs)(x.Z,{component:"form",onSubmit:handleLogin,children:[(0,i.jsx)(A.Z,{fullWidth:!0,label:"用户名或邮箱",variant:"outlined",margin:"normal",value:u.identifier,onChange:e=>p(n=>({...n,identifier:e.target.value})),required:!0}),(0,i.jsx)(A.Z,{fullWidth:!0,label:"密码",type:"password",variant:"outlined",margin:"normal",value:u.password,onChange:e=>p(n=>({...n,password:e.target.value})),required:!0}),(0,i.jsx)(g.Z,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:o,children:o?"登录中...":"登录"})]}),(0,i.jsxs)(x.Z,{sx:{textAlign:"center",mt:2},children:[(0,i.jsx)(f.Z,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"或者"}),(0,i.jsx)(g.Z,{fullWidth:!0,variant:"outlined",onClick:()=>{window.open("https://byusiaccount.cn/","_blank")},children:"通过 ByUsi 账号登录"})]})]}),(0,i.jsxs)(TabPanel,{value:s,index:1,children:[(0,i.jsxs)(x.Z,{component:"form",onSubmit:handleRegister,children:[(0,i.jsx)(A.Z,{fullWidth:!0,label:"用户名",variant:"outlined",margin:"normal",value:m.username,onChange:e=>j(n=>({...n,username:e.target.value})),required:!0}),(0,i.jsx)(A.Z,{fullWidth:!0,label:"邮箱",type:"email",variant:"outlined",margin:"normal",value:m.email,onChange:e=>j(n=>({...n,email:e.target.value})),required:!0}),(0,i.jsx)(A.Z,{fullWidth:!0,label:"密码",type:"password",variant:"outlined",margin:"normal",value:m.password,onChange:e=>j(n=>({...n,password:e.target.value})),required:!0}),(0,i.jsx)(A.Z,{fullWidth:!0,label:"确认密码",type:"password",variant:"outlined",margin:"normal",value:m.confirmPassword,onChange:e=>j(n=>({...n,confirmPassword:e.target.value})),required:!0}),(0,i.jsx)(g.Z,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},children:"注册"})]}),(0,i.jsx)(f.Z,{variant:"body2",color:"text.secondary",align:"center",sx:{mt:2},children:"点击注册将跳转到 ByUsi 账号注册页面"})]})]}),(0,i.jsx)(E.Z,{children:(0,i.jsx)(g.Z,{onClick:l,children:"取消"})})]})},components_Layout=e=>{let{children:n}=e,l=(0,_.useRouter)(),{user:q,logout:D}=(0,L.a)(),U=(0,a.Z)(),B=(0,s.Z)(U.breakpoints.down("md")),[T,z]=(0,t.useState)(null),[A,E]=(0,t.useState)(!1),[R,I]=(0,t.useState)(!1),handleClose=()=>{z(null)},handleLogout=async()=>{await D(),handleClose(),l.push("/")},N=[{text:"首页",icon:(0,i.jsx)(W.Z,{}),path:"/"},{text:"发布帖子",icon:(0,i.jsx)(S.Z,{}),onClick:()=>{if(!q){I(!0);return}l.push("/post/create")}}],F=(0,i.jsxs)(r.Z,{anchorEl:T,open:!!T,onClose:handleClose,PaperProps:{elevation:3,sx:{mt:1.5,minWidth:180}},children:[(0,i.jsxs)(o.Z,{onClick:handleClose,children:[(0,i.jsx)(d.Z,{children:(0,i.jsx)(k.Z,{fontSize:"small"})}),(0,i.jsx)(c.Z,{children:"个人资料"})]}),(null==q?void 0:q.role)==="Admin"&&(0,i.jsxs)(o.Z,{onClick:()=>{handleClose(),l.push("/admin")},children:[(0,i.jsx)(d.Z,{children:(0,i.jsx)(P.Z,{fontSize:"small"})}),(0,i.jsx)(c.Z,{children:"管理后台"})]}),(0,i.jsxs)(o.Z,{onClick:handleLogout,children:[(0,i.jsx)(d.Z,{children:(0,i.jsx)(w.Z,{fontSize:"small"})}),(0,i.jsx)(c.Z,{children:"退出登录"})]})]}),G=(0,i.jsx)(h.ZP,{anchor:"left",open:A,onClose:()=>E(!1),children:(0,i.jsx)(x.Z,{sx:{width:250,pt:2},children:(0,i.jsx)(u.Z,{children:N.map(e=>(0,i.jsxs)(p.ZP,{button:!0,onClick:()=>{e.onClick?e.onClick():e.path&&l.push(e.path),E(!1)},children:[(0,i.jsx)(d.Z,{children:e.icon}),(0,i.jsx)(c.Z,{primary:e.text})]},e.text))})})});return(0,i.jsxs)(x.Z,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[(0,i.jsx)(m.Z,{position:"sticky",color:"default",elevation:1,children:(0,i.jsxs)(j.Z,{children:[B&&(0,i.jsx)(Z.Z,{edge:"start",sx:{mr:2},onClick:()=>E(!0),children:(0,i.jsx)(y.Z,{})}),(0,i.jsx)(f.Z,{variant:"h6",component:"div",sx:{flexGrow:1,cursor:"pointer",fontWeight:600},onClick:()=>l.push("/"),children:"论坛社区"}),!B&&(0,i.jsx)(x.Z,{sx:{display:"flex",gap:1,mr:2},children:N.map(e=>(0,i.jsx)(g.Z,{color:"inherit",startIcon:e.icon,onClick:e.onClick||(()=>e.path&&l.push(e.path)),children:e.text},e.text))}),q?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(Z.Z,{onClick:e=>{z(e.currentTarget)},color:"inherit",children:(0,i.jsx)(v.Z,{sx:{width:32,height:32},children:q.username.charAt(0).toUpperCase()})}),F]}):(0,i.jsx)(g.Z,{color:"inherit",onClick:()=>{I(!0)},startIcon:(0,i.jsx)(C.Z,{}),children:"登录"})]})}),(0,i.jsx)(b.Z,{component:"main",maxWidth:"lg",sx:{flex:1,py:4,display:"flex",flexDirection:"column"},children:n}),(0,i.jsx)(x.Z,{component:"footer",sx:{py:3,px:2,mt:"auto",backgroundColor:e=>e.palette.grey[100]},children:(0,i.jsx)(b.Z,{maxWidth:"lg",children:(0,i.jsx)(f.Z,{variant:"body2",color:"text.secondary",align:"center",children:"\xa9 2025 ByUsi - 论坛社区. 使用 ByUsi 账号系统."})})}),G,(0,i.jsx)(components_LoginDialog,{open:R,onClose:()=>I(!1)})]})}}}]);
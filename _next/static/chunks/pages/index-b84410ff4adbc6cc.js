(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{36111:function(e,t,s){"use strict";var n=s(64836);t.Z=void 0;var a=n(s(64938)),r=s(85893);t.Z=(0,a.default)((0,r.jsx)("path",{d:"m12 21.35-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54z"}),"Favorite")},13328:function(e,t,s){"use strict";var n=s(64836);t.Z=void 0;var a=n(s(64938)),r=s(85893);t.Z=(0,a.default)((0,r.jsx)("path",{d:"m23 12-2.44-2.78.34-3.68-3.61-.82-1.89-3.18L12 3 8.6 1.54 6.71 4.72l-3.61.81.34 3.68L1 12l2.44 2.78-.34 3.69 3.61.82 1.89 3.18L12 21l3.4 1.46 1.89-3.18 3.61-.82-.34-3.68zm-10 5h-2v-2h2zm0-4h-2V7h2z"}),"NewReleases")},24238:function(e,t,s){"use strict";var n=s(64836);t.Z=void 0;var a=n(s(64938)),r=s(85893);t.Z=(0,a.default)((0,r.jsx)("path",{fillRule:"evenodd",d:"M16 9V4h1c.55 0 1-.45 1-1s-.45-1-1-1H7c-.55 0-1 .45-1 1s.45 1 1 1h1v5c0 1.66-1.34 3-3 3v2h5.97v7l1 1 1-1v-7H19v-2c-1.66 0-3-1.34-3-3"}),"PushPin")},87089:function(e,t,s){"use strict";var n=s(64836);t.Z=void 0;var a=n(s(64938)),r=s(85893);t.Z=(0,a.default)((0,r.jsx)("path",{d:"M13.5.67s.74 2.65.74 4.8c0 2.06-1.35 3.73-3.41 3.73-2.07 0-3.63-1.67-3.63-3.73l.03-.36C5.21 7.51 4 10.62 4 14c0 4.42 3.58 8 8 8s8-3.58 8-8C20 8.61 17.41 3.8 13.5.67M11.71 19c-1.78 0-3.22-1.4-3.22-3.14 0-1.62 1.05-2.76 2.81-3.12 1.77-.36 3.6-1.21 4.62-2.58.39 1.29.59 2.65.59 4.04 0 2.65-2.15 4.8-4.8 4.8"}),"Whatshot")},48312:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(17515)}])},68990:function(e,t,s){"use strict";s.d(t,{aF:function(){return truncateText},p6:function(){return formatDate}});let formatDate=e=>{let t=new Date(e),s=new Date,n=Math.floor((s.getTime()-t.getTime())/1e3);return n<60?"刚刚":n<3600?"".concat(Math.floor(n/60),"分钟前"):n<86400?"".concat(Math.floor(n/3600),"小时前"):n<2592e3?"".concat(Math.floor(n/86400),"天前"):t.toLocaleDateString("zh-CN")},truncateText=(e,t)=>e.length<=t?e:e.substring(0,t)+"..."},17515:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return Home}});var n=s(85893),a=s(67294),r=s(86886),i=s(66242),l=s(44267),o=s(15861),c=s(5616),d=s(11057),x=s(87918),h=s(9526),u=s(85938),p=s(96540),m=s(87089),f=s(13328),j=s(11163),Z=s(55826),v=s(69661),g=s(15398),y=s(22961),b=s(36111),C=s(14603),k=s(24238),w=s(68990),components_PostList=e=>{let{posts:t,loading:s=!1}=e,a=(0,j.useRouter)(),handlePostClick=e=>{a.push("/post/".concat(e))};return s?(0,n.jsx)(c.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsx)(i.Z,{children:(0,n.jsx)(l.Z,{children:(0,n.jsxs)(c.Z,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[(0,n.jsx)(h.Z,{variant:"circular",width:40,height:40}),(0,n.jsxs)(c.Z,{sx:{flex:1},children:[(0,n.jsx)(h.Z,{variant:"text",height:32}),(0,n.jsx)(h.Z,{variant:"text",height:20,width:"60%"}),(0,n.jsxs)(c.Z,{sx:{display:"flex",gap:1,mt:1},children:[(0,n.jsx)(h.Z,{variant:"rectangular",width:60,height:24}),(0,n.jsx)(h.Z,{variant:"rectangular",width:80,height:24})]})]})]})})},t))}):0===t.length?(0,n.jsx)(i.Z,{children:(0,n.jsxs)(l.Z,{sx:{textAlign:"center",py:8},children:[(0,n.jsx)(o.Z,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"暂无帖子"}),(0,n.jsx)(o.Z,{variant:"body2",color:"text.secondary",children:"成为第一个发布帖子的人吧！"})]})}):(0,n.jsx)(c.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:t.map(e=>(0,n.jsx)(i.Z,{sx:{cursor:"pointer",transition:"all 0.2s","&:hover":{transform:"translateY(-2px)",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"}},onClick:()=>handlePostClick(e.id),children:(0,n.jsx)(l.Z,{children:(0,n.jsxs)(c.Z,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[(0,n.jsx)(v.Z,{sx:{bgcolor:"primary.main"},children:(0,n.jsx)(g.Z,{})}),(0,n.jsxs)(c.Z,{sx:{flex:1,minWidth:0},children:[(0,n.jsxs)(c.Z,{sx:{display:"flex",alignItems:"flex-start",gap:1,mb:1},children:[e.is_pinned&&(0,n.jsx)(k.Z,{color:"primary",sx:{fontSize:16}}),(0,n.jsx)(o.Z,{variant:"h6",component:"h2",sx:{flex:1,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:e.title})]}),(0,n.jsx)(o.Z,{variant:"body2",color:"text.secondary",sx:{mb:2,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical"},children:(0,w.aF)(e.content.replace(/[#*`]/g,""),150)}),(0,n.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap",mb:1},children:[(0,n.jsx)(x.Z,{label:e.category,size:"small",variant:"outlined",sx:{borderColor:"primary.main",color:"primary.main"}}),e.tags.map(e=>(0,n.jsx)(x.Z,{label:e,size:"small",variant:"outlined"},e))]}),(0,n.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",gap:2,flexWrap:"wrap"},children:[(0,n.jsx)(o.Z,{variant:"body2",color:"text.secondary",children:e.author_username}),(0,n.jsx)(o.Z,{variant:"body2",color:"text.secondary",children:(0,w.p6)(e.created_at)}),(0,n.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",gap:.5,ml:"auto"},children:[(0,n.jsx)(y.Z,{fontSize:"small",color:"action"}),(0,n.jsx)(o.Z,{variant:"body2",color:"text.secondary",children:e.view_count})]}),(0,n.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,n.jsx)(b.Z,{fontSize:"small",color:"action"}),(0,n.jsx)(o.Z,{variant:"body2",color:"text.secondary",children:e.like_count})]}),(0,n.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,n.jsx)(C.Z,{fontSize:"small",color:"action"}),(0,n.jsx)(o.Z,{variant:"body2",color:"text.secondary",children:e.comment_count})]})]})]})]})})},e.id))})},_=s(46435),I=s(87179);function Home(){let e=(0,j.useRouter)(),{user:t}=(0,I.a)(),[s,v]=(0,a.useState)([]),[g,y]=(0,a.useState)([]),[b,C]=(0,a.useState)("全部"),[k,w]=(0,a.useState)(!0);(0,a.useEffect)(()=>{loadData()},[]);let loadData=async()=>{try{w(!0);let[e,t]=await Promise.all([_.l8.getPosts(),_.lk.getCategories()]);e.success&&e.data&&v(e.data),t.success&&t.data&&y(t.data)}catch(e){console.error("加载数据失败:",e)}finally{w(!1)}},z="全部"===b?s:s.filter(e=>e.category===b),P=g.sort((e,t)=>t.post_count-e.post_count).slice(0,5);return(0,n.jsx)(Z.Z,{children:(0,n.jsxs)(r.ZP,{container:!0,spacing:4,children:[(0,n.jsxs)(r.ZP,{item:!0,xs:12,md:3,children:[(0,n.jsx)(i.Z,{sx:{position:"sticky",top:100},children:(0,n.jsxs)(l.Z,{children:[(0,n.jsx)(o.Z,{variant:"h6",gutterBottom:!0,children:"分类"}),(0,n.jsxs)(c.Z,{sx:{display:"flex",flexDirection:"column",gap:1,mb:3},children:[(0,n.jsx)(d.Z,{fullWidth:!0,startIcon:(0,n.jsx)(u.Z,{}),variant:"全部"===b?"contained":"outlined",onClick:()=>C("全部"),sx:{justifyContent:"flex-start"},children:"全部"}),g.map(e=>(0,n.jsxs)(d.Z,{fullWidth:!0,startIcon:(0,n.jsx)(u.Z,{}),variant:b===e.name?"contained":"outlined",onClick:()=>C(e.name),sx:{justifyContent:"flex-start",borderColor:e.color,color:b===e.name?"#fff":e.color,backgroundColor:b===e.name?e.color:"transparent","&:hover":{backgroundColor:b===e.name?e.color:"".concat(e.color,"20")}},children:[e.name,(0,n.jsx)(x.Z,{label:e.post_count,size:"small",sx:{ml:"auto",backgroundColor:"transparent",color:"inherit",borderColor:"currentColor"}})]},e.id))]}),(0,n.jsx)(d.Z,{fullWidth:!0,variant:"contained",startIcon:(0,n.jsx)(p.Z,{}),onClick:()=>{t&&e.push("/post/create")},children:"发布帖子"})]})}),(0,n.jsx)(i.Z,{sx:{mt:2},children:(0,n.jsxs)(l.Z,{children:[(0,n.jsxs)(o.Z,{variant:"h6",gutterBottom:!0,children:[(0,n.jsx)(m.Z,{sx:{verticalAlign:"middle",mr:1}}),"热门分类"]}),(0,n.jsx)(c.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:k?[void 0,void 0,void 0].map((e,t)=>(0,n.jsx)(h.Z,{variant:"rectangular",height:40},t)):P.map(e=>(0,n.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:1,borderRadius:1,backgroundColor:"grey.50",cursor:"pointer","&:hover":{backgroundColor:"grey.100"}},onClick:()=>C(e.name),children:[(0,n.jsx)(o.Z,{variant:"body2",children:e.name}),(0,n.jsx)(x.Z,{label:e.post_count,size:"small",variant:"outlined"})]},e.id))})]})})]}),(0,n.jsxs)(r.ZP,{item:!0,xs:12,md:9,children:[(0,n.jsxs)(c.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,n.jsx)(o.Z,{variant:"h4",component:"h1",children:"全部"===b?"最新帖子":b}),(0,n.jsxs)(c.Z,{sx:{display:"flex",gap:1},children:[(0,n.jsx)(d.Z,{variant:"全部"===b?"contained":"outlined",startIcon:(0,n.jsx)(f.Z,{}),onClick:()=>C("全部"),children:"最新"}),(0,n.jsx)(d.Z,{variant:"outlined",startIcon:(0,n.jsx)(m.Z,{}),disabled:!0,children:"热门"})]})]}),(0,n.jsx)(components_PostList,{posts:z,loading:k})]})]})})}}},function(e){e.O(0,[838,526,349,286,826,774,888,179],function(){return e(e.s=48312)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[687],{36111:function(e,t,i){"use strict";var r=i(64836);t.Z=void 0;var n=r(i(64938)),a=i(85893);t.Z=(0,n.default)((0,a.jsx)("path",{d:"m12 21.35-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54z"}),"Favorite")},91811:function(e,t,i){"use strict";var r=i(64836);t.Z=void 0;var n=r(i(64938)),a=i(85893);t.Z=(0,n.default)((0,a.jsx)("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3m-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05"}),"FavoriteBorder")},64459:function(e,t,i){"use strict";var r=i(64836);t.Z=void 0;var n=r(i(64938)),a=i(85893);t.Z=(0,n.default)((0,a.jsx)("path",{d:"M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11"}),"Reply")},11359:function(e,t,i){"use strict";var r=i(64836);t.Z=void 0;var n=r(i(64938)),a=i(85893);t.Z=(0,n.default)((0,a.jsx)("path",{d:"M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92"}),"Share")},23208:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/post/[id]",function(){return i(87057)}])},68990:function(e,t,i){"use strict";i.d(t,{aF:function(){return truncateText},p6:function(){return formatDate}});let formatDate=e=>{let t=new Date(e),i=new Date,r=Math.floor((i.getTime()-t.getTime())/1e3);return r<60?"刚刚":r<3600?"".concat(Math.floor(r/60),"分钟前"):r<86400?"".concat(Math.floor(r/3600),"小时前"):r<2592e3?"".concat(Math.floor(r/86400),"天前"):t.toLocaleDateString("zh-CN")},truncateText=(e,t)=>e.length<=t?e:e.substring(0,t)+"..."},87057:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return PostDetail}});var r=i(85893),n=i(67294),a=i(11163),l=i(66242),o=i(44267),s=i(9526),c=i(5616),d=i(15861),h=i(69661),x=i(87918),u=i(93946),m=i(63366),g=i(87462),p=i(90512),v=i(94780),Z=i(2101),f=i(90948),j=i(28628),b=i(35097);let y=["absolute","children","className","component","flexItem","light","orientation","role","textAlign","variant"],useUtilityClasses=e=>{let{absolute:t,children:i,classes:r,flexItem:n,light:a,orientation:l,textAlign:o,variant:s}=e;return(0,v.Z)({root:["root",t&&"absolute",s,a&&"light","vertical"===l&&"vertical",n&&"flexItem",i&&"withChildren",i&&"vertical"===l&&"withChildrenVertical","right"===o&&"vertical"!==l&&"textAlignRight","left"===o&&"vertical"!==l&&"textAlignLeft"],wrapper:["wrapper","vertical"===l&&"wrapperVertical"]},b.V,r)},w=(0,f.ZP)("div",{name:"MuiDivider",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:i}=e;return[t.root,i.absolute&&t.absolute,t[i.variant],i.light&&t.light,"vertical"===i.orientation&&t.vertical,i.flexItem&&t.flexItem,i.children&&t.withChildren,i.children&&"vertical"===i.orientation&&t.withChildrenVertical,"right"===i.textAlign&&"vertical"!==i.orientation&&t.textAlignRight,"left"===i.textAlign&&"vertical"!==i.orientation&&t.textAlignLeft]}})(({theme:e,ownerState:t})=>(0,g.Z)({margin:0,flexShrink:0,borderWidth:0,borderStyle:"solid",borderColor:(e.vars||e).palette.divider,borderBottomWidth:"thin"},t.absolute&&{position:"absolute",bottom:0,left:0,width:"100%"},t.light&&{borderColor:e.vars?`rgba(${e.vars.palette.dividerChannel} / 0.08)`:(0,Z.Fq)(e.palette.divider,.08)},"inset"===t.variant&&{marginLeft:72},"middle"===t.variant&&"horizontal"===t.orientation&&{marginLeft:e.spacing(2),marginRight:e.spacing(2)},"middle"===t.variant&&"vertical"===t.orientation&&{marginTop:e.spacing(1),marginBottom:e.spacing(1)},"vertical"===t.orientation&&{height:"100%",borderBottomWidth:0,borderRightWidth:"thin"},t.flexItem&&{alignSelf:"stretch",height:"auto"}),({ownerState:e})=>(0,g.Z)({},e.children&&{display:"flex",whiteSpace:"nowrap",textAlign:"center",border:0,borderTopStyle:"solid",borderLeftStyle:"solid","&::before, &::after":{content:'""',alignSelf:"center"}}),({theme:e,ownerState:t})=>(0,g.Z)({},t.children&&"vertical"!==t.orientation&&{"&::before, &::after":{width:"100%",borderTop:`thin solid ${(e.vars||e).palette.divider}`,borderTopStyle:"inherit"}}),({theme:e,ownerState:t})=>(0,g.Z)({},t.children&&"vertical"===t.orientation&&{flexDirection:"column","&::before, &::after":{height:"100%",borderLeft:`thin solid ${(e.vars||e).palette.divider}`,borderLeftStyle:"inherit"}}),({ownerState:e})=>(0,g.Z)({},"right"===e.textAlign&&"vertical"!==e.orientation&&{"&::before":{width:"90%"},"&::after":{width:"10%"}},"left"===e.textAlign&&"vertical"!==e.orientation&&{"&::before":{width:"10%"},"&::after":{width:"90%"}})),C=(0,f.ZP)("span",{name:"MuiDivider",slot:"Wrapper",overridesResolver:(e,t)=>{let{ownerState:i}=e;return[t.wrapper,"vertical"===i.orientation&&t.wrapperVertical]}})(({theme:e,ownerState:t})=>(0,g.Z)({display:"inline-block",paddingLeft:`calc(${e.spacing(1)} * 1.2)`,paddingRight:`calc(${e.spacing(1)} * 1.2)`},"vertical"===t.orientation&&{paddingTop:`calc(${e.spacing(1)} * 1.2)`,paddingBottom:`calc(${e.spacing(1)} * 1.2)`})),S=n.forwardRef(function(e,t){let i=(0,j.i)({props:e,name:"MuiDivider"}),{absolute:n=!1,children:a,className:l,component:o=a?"div":"hr",flexItem:s=!1,light:c=!1,orientation:d="horizontal",role:h="hr"!==o?"separator":void 0,textAlign:x="center",variant:u="fullWidth"}=i,v=(0,m.Z)(i,y),Z=(0,g.Z)({},i,{absolute:n,component:o,flexItem:s,light:c,orientation:d,role:h,textAlign:x,variant:u}),f=useUtilityClasses(Z);return(0,r.jsx)(w,(0,g.Z)({as:o,className:(0,p.Z)(f.root,l),role:h,ref:t,ownerState:Z},v,{children:a?(0,r.jsx)(C,{className:f.wrapper,ownerState:Z,children:a}):null}))});S.muiSkipListHighlight=!0;var _=i(15398),k=i(22961),L=i(36111),z=i(91811),A=i(11359),D=i(55826),I=i(19273),R=i(11057),T=i(64459),W=i(68990),P=i(87179),components_CommentList=e=>{let{comments:t,postId:i,onCommentAdded:a,loading:x=!1}=e,{user:m}=(0,P.a)(),[g,p]=(0,n.useState)(""),[v,Z]=(0,n.useState)(null),[f,j]=(0,n.useState)(!1),handleSubmitComment=async()=>{if(g.trim()){j(!0);try{p(""),Z(null),a()}catch(e){console.error("提交评论失败:",e)}finally{j(!1)}}},renderComment=function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=3*i;return(0,r.jsxs)(c.Z,{sx:{ml:n,mb:2},children:[(0,r.jsx)(l.Z,{variant:"outlined",children:(0,r.jsx)(o.Z,{children:(0,r.jsxs)(c.Z,{sx:{display:"flex",gap:2},children:[(0,r.jsx)(h.Z,{sx:{width:40,height:40,bgcolor:"primary.main"},children:(0,r.jsx)(_.Z,{})}),(0,r.jsxs)(c.Z,{sx:{flex:1},children:[(0,r.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[(0,r.jsx)(d.Z,{variant:"subtitle1",fontWeight:"medium",children:e.author_username}),(0,r.jsx)(d.Z,{variant:"body2",color:"text.secondary",children:(0,W.p6)(e.created_at)})]}),(0,r.jsx)(d.Z,{variant:"body1",paragraph:!0,children:e.content}),(0,r.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(u.Z,{size:"small",children:(0,r.jsx)(z.Z,{fontSize:"small"})}),(0,r.jsx)(d.Z,{variant:"body2",color:"text.secondary",children:e.like_count}),(0,r.jsx)(u.Z,{size:"small",onClick:()=>Z(e.id),children:(0,r.jsx)(T.Z,{fontSize:"small"})}),(0,r.jsx)(d.Z,{variant:"body2",color:"text.secondary",children:"回复"})]})]})]})})}),t.filter(t=>t.parent_id===e.id).map(e=>renderComment(e,i+1))]},e.id)};if(x)return(0,r.jsx)(c.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:[void 0,void 0,void 0].map((e,t)=>(0,r.jsx)(l.Z,{variant:"outlined",children:(0,r.jsx)(o.Z,{children:(0,r.jsxs)(c.Z,{sx:{display:"flex",gap:2},children:[(0,r.jsx)(s.Z,{variant:"circular",width:40,height:40}),(0,r.jsxs)(c.Z,{sx:{flex:1},children:[(0,r.jsx)(s.Z,{variant:"text",height:24,width:"40%"}),(0,r.jsx)(s.Z,{variant:"text",height:20,width:"60%"}),(0,r.jsx)(s.Z,{variant:"text",height:60})]})]})})},t))});let b=t.filter(e=>!e.parent_id);return(0,r.jsxs)(c.Z,{children:[m&&(0,r.jsx)(l.Z,{variant:"outlined",sx:{mb:3},children:(0,r.jsxs)(o.Z,{children:[(0,r.jsx)(d.Z,{variant:"h6",gutterBottom:!0,children:v?"回复评论":"发表评论"}),(0,r.jsx)(I.Z,{fullWidth:!0,multiline:!0,rows:4,placeholder:v?"写下您的回复...":"写下您的评论...",value:g,onChange:e=>p(e.target.value),variant:"outlined",sx:{mb:2}}),(0,r.jsxs)(c.Z,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[v&&(0,r.jsx)(R.Z,{onClick:()=>Z(null),children:"取消回复"}),(0,r.jsx)(R.Z,{variant:"contained",onClick:handleSubmitComment,disabled:!g.trim()||f,children:f?"提交中...":"提交评论"})]})]})}),(0,r.jsxs)(d.Z,{variant:"h6",gutterBottom:!0,children:["评论 (",t.length,")"]}),0===b.length?(0,r.jsx)(l.Z,{variant:"outlined",children:(0,r.jsxs)(o.Z,{sx:{textAlign:"center",py:4},children:[(0,r.jsx)(d.Z,{variant:"body1",color:"text.secondary",children:"暂无评论"}),(0,r.jsx)(d.Z,{variant:"body2",color:"text.secondary",children:m?"成为第一个评论的人吧！":"登录后即可发表评论"})]})}):b.map(e=>renderComment(e))]})},M=i(46435),N=i(25332),$=i(4958),B=i(34209),E=i(84283);function PostDetail(){let e=(0,a.useRouter)(),{id:t}=e.query,[i,m]=(0,n.useState)(null),[g,p]=(0,n.useState)([]),[v,Z]=(0,n.useState)(!0),[f,j]=(0,n.useState)(!1);(0,n.useEffect)(()=>{t&&(loadPost(),loadComments())},[t]);let loadPost=async()=>{try{let i=await M.l8.getPost(t);i.success&&i.data?m(i.data):e.push("/404")}catch(t){console.error("加载帖子失败:",t),e.push("/404")}finally{Z(!1)}},loadComments=async()=>{try{let e=await M.ec.getComments(t);e.success&&e.data&&p(e.data)}catch(e){console.error("加载评论失败:",e)}};return v?(0,r.jsx)(D.Z,{children:(0,r.jsx)(l.Z,{children:(0,r.jsxs)(o.Z,{children:[(0,r.jsx)(s.Z,{variant:"text",height:40}),(0,r.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[(0,r.jsx)(s.Z,{variant:"circular",width:40,height:40}),(0,r.jsxs)(c.Z,{children:[(0,r.jsx)(s.Z,{variant:"text",height:24,width:120}),(0,r.jsx)(s.Z,{variant:"text",height:20,width:80})]})]}),(0,r.jsx)(s.Z,{variant:"rectangular",height:400})]})})}):i?(0,r.jsx)(D.Z,{children:(0,r.jsxs)(c.Z,{sx:{display:"flex",flexDirection:"column",gap:3},children:[(0,r.jsx)(l.Z,{children:(0,r.jsxs)(o.Z,{children:[(0,r.jsx)(d.Z,{variant:"h4",component:"h1",gutterBottom:!0,children:i.title}),(0,r.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",gap:2,mb:3,flexWrap:"wrap"},children:[(0,r.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(h.Z,{sx:{width:32,height:32,bgcolor:"primary.main"},children:(0,r.jsx)(_.Z,{})}),(0,r.jsx)(d.Z,{variant:"body1",fontWeight:"medium",children:i.author_username})]}),(0,r.jsx)(d.Z,{variant:"body2",color:"text.secondary",children:(0,W.p6)(i.created_at)}),(0,r.jsx)(x.Z,{label:i.category,size:"small",variant:"outlined",sx:{borderColor:"primary.main",color:"primary.main"}}),i.tags.map(e=>(0,r.jsx)(x.Z,{label:e,size:"small",variant:"outlined"},e)),(0,r.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",gap:1,ml:"auto"},children:[(0,r.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,r.jsx)(k.Z,{fontSize:"small",color:"action"}),(0,r.jsx)(d.Z,{variant:"body2",color:"text.secondary",children:i.view_count})]}),(0,r.jsx)(u.Z,{size:"small",onClick:()=>{j(!f)},children:f?(0,r.jsx)(L.Z,{color:"error"}):(0,r.jsx)(z.Z,{})}),(0,r.jsx)(d.Z,{variant:"body2",color:"text.secondary",children:i.like_count+(f?1:0)}),(0,r.jsx)(u.Z,{size:"small",onClick:()=>{navigator.share?navigator.share({title:null==i?void 0:i.title,text:null==i?void 0:i.content.substring(0,100),url:window.location.href}):navigator.clipboard.writeText(window.location.href)},children:(0,r.jsx)(A.Z,{})})]})]}),(0,r.jsx)(S,{sx:{mb:3}}),(0,r.jsx)(c.Z,{sx:{"& img":{maxWidth:"100%",height:"auto",width:"100%",borderRadius:1}},children:(0,r.jsx)(N.UG,{remarkPlugins:[$.Z],components:{code:e=>{let{inline:t,className:i,children:n,...a}=e,l=/language-(\w+)/.exec(i||""),o=l?l[1]:"";return!t&&o?(0,r.jsx)(B.Z,{style:E.$E,language:o,PreTag:"div",...a,children:String(n).replace(/\n$/,"")}):(0,r.jsx)("code",{className:i,...a,children:n})},img:e=>(0,r.jsx)("img",{...e,style:{maxWidth:"100%",height:"auto",width:"100%",borderRadius:4},alt:e.alt||""})},children:i.content})})]})}),(0,r.jsx)(components_CommentList,{comments:g,postId:i.id,onCommentAdded:loadComments})]})}):(0,r.jsx)(D.Z,{children:(0,r.jsx)(l.Z,{children:(0,r.jsx)(o.Z,{sx:{textAlign:"center",py:8},children:(0,r.jsx)(d.Z,{variant:"h5",color:"text.secondary",children:"帖子不存在"})})})})}}},function(e){e.O(0,[838,526,349,714,826,774,888,179],function(){return e(e.s=23208)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[495],{5511:function(e,a,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/register",function(){return n(7551)}])},7551:function(e,a,n){"use strict";n.r(a),n.d(a,{default:function(){return Register}});var s=n(5893),r=n(7294),i=n(3953),t=n(5616),l=n(629),o=n(5861),c=n(5568),d=n(6886),m=n(1701),u=n(9417),h=n(8456),p=n(1163),x=n(7955),f=n(5521);function Register(){let[e,a]=(0,r.useState)({username:"",email:"",password:"",confirmPassword:""}),[n,w]=(0,r.useState)(!1),[g,j]=(0,r.useState)(""),[y,b]=(0,r.useState)(null),[Z,P]=(0,r.useState)(null),{register:v}=(0,x.a)(),C=(0,p.useRouter)(),handleChange=n=>{a({...e,[n.target.name]:n.target.value}),j("")},checkUsernameAvailability=async()=>{if(!(e.username.length<3))try{let a=await fetch("/api/check-username",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e.username})}),n=await a.json();b(n.available)}catch(e){console.error("检查用户名可用性失败:",e)}},checkEmailAvailability=async()=>{if(e.email.includes("@"))try{let a=await fetch("/api/check-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email})}),n=await a.json();P(n.available)}catch(e){console.error("检查邮箱可用性失败:",e)}},handleSubmit=async a=>{if(a.preventDefault(),w(!0),j(""),e.password!==e.confirmPassword){j("两次输入的密码不一致"),w(!1);return}if(e.password.length<6){j("密码长度不能少于6位"),w(!1);return}try{let a=await v(e.username,e.email,e.password);a.success?C.push("/login?message=注册成功，请登录"):j(a.message||"注册失败")}catch(e){j("网络错误，请稍后重试")}finally{w(!1)}};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.Z,{title:"用户注册",description:"注册新的 ByUsi 账户系统账号",keywords:"注册,创建账户,用户注册,ByUsi"}),(0,s.jsx)(i.Z,{component:"main",maxWidth:"sm",children:(0,s.jsx)(t.Z,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:(0,s.jsxs)(l.Z,{elevation:3,sx:{p:4,width:"100%"},children:[(0,s.jsx)(o.Z,{component:"h1",variant:"h4",align:"center",gutterBottom:!0,children:"用户注册"}),g&&(0,s.jsx)(c.Z,{severity:"error",sx:{mb:2},children:g}),(0,s.jsxs)(t.Z,{component:"form",onSubmit:handleSubmit,sx:{mt:1},children:[(0,s.jsxs)(d.ZP,{container:!0,spacing:2,children:[(0,s.jsx)(d.ZP,{item:!0,xs:12,children:(0,s.jsx)(m.Z,{required:!0,fullWidth:!0,id:"username",label:"用户名",name:"username",autoComplete:"username",value:e.username,onChange:handleChange,onBlur:checkUsernameAvailability,error:!1===y,helperText:!1===y?"用户名已被使用":!0===y?"用户名可用":"用户名长度3-20位"})}),(0,s.jsx)(d.ZP,{item:!0,xs:12,children:(0,s.jsx)(m.Z,{required:!0,fullWidth:!0,id:"email",label:"邮箱地址",name:"email",autoComplete:"email",value:e.email,onChange:handleChange,onBlur:checkEmailAvailability,error:!1===Z,helperText:!1===Z?"邮箱已被使用":!0===Z?"邮箱可用":"请输入有效的邮箱地址"})}),(0,s.jsx)(d.ZP,{item:!0,xs:12,children:(0,s.jsx)(m.Z,{required:!0,fullWidth:!0,name:"password",label:"密码",type:"password",id:"password",autoComplete:"new-password",value:e.password,onChange:handleChange,helperText:"密码长度不能少于6位"})}),(0,s.jsx)(d.ZP,{item:!0,xs:12,children:(0,s.jsx)(m.Z,{required:!0,fullWidth:!0,name:"confirmPassword",label:"确认密码",type:"password",id:"confirmPassword",value:e.confirmPassword,onChange:handleChange,error:e.password!==e.confirmPassword&&""!==e.confirmPassword,helperText:e.password!==e.confirmPassword&&""!==e.confirmPassword?"两次输入的密码不一致":""})})]}),(0,s.jsx)(u.Z,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:n||!1===y||!1===Z,children:n?(0,s.jsx)(h.Z,{size:24}):"注册"}),(0,s.jsx)(t.Z,{sx:{textAlign:"center"},children:(0,s.jsx)(u.Z,{onClick:()=>C.push("/login"),sx:{textTransform:"none"},children:"已有账户？立即登录"})})]})]})})})]})}}},function(e){e.O(0,[14,886,89,542,774,888,179],function(){return e(e.s=5511)}),_N_E=e.O()}]);